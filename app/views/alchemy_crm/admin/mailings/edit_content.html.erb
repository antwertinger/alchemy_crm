<%- content_for(:javascript_includes) do -%>
	<%= javascript_include_tag "alchemy_crm/scripts.js" %>
<%- end -%>

<%- content_for(:stylesheets) do -%>
	<%= stylesheet_link_tag('alchemy_crm/styles') %>
<%- end -%>

<%- content_for(:subnav_additions) do -%>
	<span class="page_status_and_name">
		<span class="page_name"><%= @mailing.name %></span>
	</span>
<%- end -%>
<%- content_for(:toolbar) do -%>
<div id="toolbar">
	<div id="toolbar_buttons">
		<div class="button_with_label">
			<%= form_tag(
				unlock_admin_page_path(
					@page,
					:redirect_to => admin_mailings_path
				),
				:onsubmit => "return Alchemy.checkPageDirtyness(this, {title: '#{ t('Warning!') }', message: '#{ _('You have unsaved elements on this page. Do you really want to leave this page?') }', okLabel: '#{ _('Yes') }', cancelLabel: '#{ _('No') }'});"
			) do %>
				<button class="icon_button" title="<%= t('explain_unlocking') %>">
					<%= render_icon('close') %>
				</button><br />
				<label><%= t("unlock_page") %></label>
			<% end %>
		</div>
		<div class="button_with_label">
			<%= link_to(
				mailing_path(@mailing),
				:onclick => "return Alchemy.checkPageDirtyness(this, {title: '#{ t('Warning!') }', message: '#{ _('You have unsaved elements on this page. Do you really want to leave this page?') }', okLabel: '#{ _('Yes') }', cancelLabel: '#{ _('No') }'});",
				:class => 'icon_button'
			) do %>
				<%= render_icon('visit_page') %>
			<% end %>
			<label><%= t("Visit page") %></label>
		</div>
		<div class="button_with_label">
			<%= link_to_overlay_window(
				render_icon('mailing_edit'),
					edit_admin_mailing_path(@mailing),
					{
						:title => 'Mailing bearbeiten',
						:size => '450x270'
					},
					{
						:class => 'icon_button',
						:title => 'Mailing bearbeiten'
					}
			) -%><br />
			<label>Mailing bearbeiten</label>
		</div>
		<div class="button_with_label">
			<%= link_to_overlay_window(
				render_icon('send_mailing'),
				new_admin_delivery_path(:mailing_id => @mailing.id),
				{
					:title => t('Send Mailing'),
					:size => '350x210'
				},
				{
					:title => t('Send Mailing'),
					:class => 'icon_button'
				}
			) %>
			<label><%= t('Send Mailing') %></label>
		</div>
	</div>
	<div id="toolbar_buttons_right">
		<div class="button_with_label" id="show_preview_window">
			<%= link_to_function(
				render_icon('preview_window'),
				"openPreviewWindow()",
				{
					:title => t('Show Preview Window'),
					:class => 'icon_button'
				}
			) %><br />
			<label><%= t('Show Preview Window') %></label>
		</div>
		<div class="button_with_label" id="show_element_window">
			<%= link_to_function(
				render_icon('element_window'),
				"openElementsWindow()",
				{
					:title => t('Show Elements Window'),
					:class => 'icon_button'
				}
			) %><br />
			<label><%= t('Show Elements Window') %></label>
		</div>
	</div>
</div>
<%- end -%>
<%- content_for :javascripts do -%>
<script type="text/javascript" charset="utf-8">
	
	function openPreviewWindow() {
		Alchemy.openPreviewWindow('<%= admin_page_url(@page) %>', '<%= t("Page Preview") -%>');
	}
	
	function openElementsWindow() {
		Alchemy.openElementsWindow('<%= admin_elements_path(:page_id => @page.id) -%>', {
			texts: {
				title: '<%= t("Elements") -%>',
				dirtyTitle: '<%= t("Warning!") -%>',
				dirtyMessage: '<%= t("You have unsaved elements. Do you really want to close the elements window?") -%>',
				okLabel: '<%= t("Yes") -%>',
				cancelLabel: '<%= t("No") -%>'
			},
			toolbarButtons: [
				{
					title: '<%= t("New Element") -%>',
					label: '<%= t("New Element") -%>',
					iconClass: 'new_element',
					onClick: function() {
						Alchemy.openWindow(
							'<%= new_admin_element_path(:page_id => @page.id) -%>',
							'<%= t("New Element") -%>',
							'410',
							'75',
							false,
							true,
							true
						);
					}
				},
				{
					title: '<%= t("Clipboard") -%>',
					label: '<%= t("Show clipboard") -%>',
					iconClass: 'clipboard<%= clipboard_empty?("elements") ? "" : " full" -%>',
					buttonId: 'clipboard_button',
					onClick: function() {
						Alchemy.openWindow(
							'<%= admin_clipboard_path(:remarkable_type => "element") -%>',
							'<%= t("Clipboard") -%>',
							'380',
							'270',
							false,
							true,
							true
						);
					}
				},
				{
					title: '<%= t("Show trash") -%>',
					label: '<%= t("Show trash") -%>',
					iconClass: 'trash<%= trash_empty?("elements") ? "" : " full" -%>',
					buttonId: 'element_trash_button',
					onClick: function() {
						Alchemy.openTrashWindow(<%= @page.id %>, '<%= t("Trash") -%>');
					}
				}
			]
		});
	}
	
	jQuery(document).ready(function() {
		openElementsWindow();
		openPreviewWindow();
	});
	
	Alchemy.PageLeaveObserver({
		title: '<%= t("Warning!") -%>',
		message: '<%=  t("You have unsaved elements on this page. Do you really want to leave this page?") -%>',
		okLabel: '<%= t("Yes") -%>',
		cancelLabel: '<%= t("No") -%>'
	});
	
</script>
<%- end -%>
