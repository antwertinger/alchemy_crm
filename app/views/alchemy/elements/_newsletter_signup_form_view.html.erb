<% @newsletters ||= AlchemyCrm::Newsletter.subscribables -%>

<% if @contact_signed_up -%>

<%= raw element.ingredient('signed_up_text') % {:name => @contact.fullname} %>

<% elsif @contact_verified -%>

<%= raw element.ingredient('verified_text') % {:name => @contact.fullname} %>

<% else -%>

<%= form_for [alchemy_crm, @contact ||= AlchemyCrm::Contact.new], :url => alchemy_crm.signup_contacts_path do |form| %>
	<% if flash[:notice].present? -%>
	<p class="flash notice"><%= flash[:notice] %></p>
	<% end -%>
	<%= form.error_messages %>
	<table>
		<tr>
			<td><%= form.label :salutation %></td>
			<td><%= form.select :salutation, options_for_select([[t('Please choose'), ''], [t('male'), 'male'], [t('female'), 'female']], @contact.salutation) %></td>
		</tr>
		<tr>
			<td><%= form.label :firstname %></td>
			<td><%= form.text_field :firstname %></td>
		</tr>
		<tr>
			<td><%= form.label :lastname %></td>
			<td><%= form.text_field :lastname %></td>
		</tr>
		<tr>
			<td><%= form.label :address %></td>
			<td><%= form.text_field :address %></td>
		</tr>
		<tr>
			<td><%= form.label :zip %></td>
			<td><%= form.text_field :zip %></td>
		</tr>
		<tr>
			<td><%= form.label :city %></td>
			<td><%= form.text_field :city %></td>
		</tr>
		<tr>
			<td><%= form.label :phone %></td>
			<td><%= form.text_field :phone %></td>
		</tr>
		<tr>
			<td><%= form.label :email %></td>
			<td><%= form.text_field :email %></td>
		</tr>
	</table>
	<%= render_essence_view_by_name element, 'choose_newsletter_text' %>
	<% if @newsletters.length > 1 -%>
		<% @newsletters.each_with_index do |newsletter, idx| -%>
		<p>
			<%= check_box_tag "contact[subscriptions_attributes][#{idx}][newsletter_id]", newsletter.id, @contact.subscriptions.detect { |ns| ns.newsletter_id == newsletter.id } %>
			<%= label_tag "contact[subscriptions_attributes][#{idx}][newsletter_id]", newsletter.name %>
		</p>
		<% end -%>
	<% elsif @newsletters.length == 1 -%>
		<%= hidden_field_tag "contact[subscriptions_attributes][0][newsletter_id]", @newsletters.first.id %>
	<% end -%>
	<%= form.submit ::I18n.t('subscribe_form.button_label', :scope => :alchemy_crm), :name => nil %>
<% end %>

<% end -%>
